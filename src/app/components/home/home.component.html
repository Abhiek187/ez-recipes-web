<!-- Hide the find recipe button once a recipe is fetched -->
<div class="find-recipe-button-container">
  <button
    mat-raised-button
    color="accent"
    class="find-recipe-button"
    (click)="getRandomRecipe()"
    [disabled]="isLoading()"
  >
    Find Me a Recipe!
  </button>
</div>

@if (isLoading()) {
<mat-spinner diameter="50" class="progress-spinner" />
<p class="loading-message">{{ loadingMessage() }}</p>
}

<!-- Multiple accordions can be expanded -->
<mat-accordion multi class="home-accordion">
  <mat-expansion-panel
    class="favorites-accordion"
    (opened)="onExpandFavorites()"
  >
    <mat-expansion-panel-header>
      <mat-panel-title>üíñ Favorites</mat-panel-title>
    </mat-expansion-panel-header>

    @if (!isLoggedIn()) { @if (isLoading()) {
    <!-- Show the recipe cards loading while waiting for both the auth state & recipes -->
    <app-recipe-card-loader />
    } @else {
    <!-- Encourage the user to sign in to see these recipes -->
    <p>Sign in to view your saved recipes</p>
    } } @else if (favoriteRecipes().length === 0) {
    <p>No recipes found</p>
    } @else {
    <ul class="recipe-card-list">
      @for (recipe of favoriteRecipes(); track recipe?.id) {
      <li>
        @if (recipe !== undefined) {
        <app-recipe-card [recipe]="recipe" />
        } @else {
        <app-recipe-card-loader />
        }
      </li>
      }
    </ul>
    }
  </mat-expansion-panel>

  <mat-expansion-panel class="recents-accordion" (opened)="onExpandRecents()">
    <mat-expansion-panel-header>
      <mat-panel-title>‚åö Recently Viewed</mat-panel-title>
    </mat-expansion-panel-header>

    @if (!isLoggedIn()) {
    <!-- Show what's stored locally while the chef isn't signed in -->
    @if (recentRecipesLocal().length === 0) {
    <p>No recipes found</p>
    } @else {
    <ul class="recipe-card-list">
      @for (recipe of recentRecipesLocal(); track recipe.id) {
      <li>
        <app-recipe-card [recipe]="recipe" />
      </li>
      }
    </ul>
    } } @else if (recentRecipesRemote().length === 0) {
    <p>No recipes found</p>
    } @else {
    <ul class="recipe-card-list">
      @for (recipe of recentRecipesRemote(); track recipe?.id) {
      <li>
        @if (recipe !== undefined) {
        <app-recipe-card [recipe]="recipe" />
        } @else {
        <app-recipe-card-loader />
        }
      </li>
      }
    </ul>
    }
  </mat-expansion-panel>

  <mat-expansion-panel class="ratings-accordion" (opened)="onExpandRatings()">
    <mat-expansion-panel-header>
      <mat-panel-title>‚≠ê Ratings</mat-panel-title>
    </mat-expansion-panel-header>

    @if (!isLoggedIn()) { @if (isLoading()) {
    <app-recipe-card-loader />
    } @else {
    <p>Sign in to view your saved recipes</p>
    } } @else if (ratedRecipes().length === 0) {
    <p>No recipes found</p>
    } @else {
    <ul class="recipe-card-list">
      @for (recipe of ratedRecipes(); track recipe?.id) {
      <li>
        @if (recipe !== undefined) {
        <app-recipe-card [recipe]="recipe" />
        } @else {
        <app-recipe-card-loader />
        }
      </li>
      }
    </ul>
    }
  </mat-expansion-panel>
</mat-accordion>
